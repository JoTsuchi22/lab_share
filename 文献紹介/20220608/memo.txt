文献調査 日本語訳

設計特徴量のセグメンテーション・マッピング・マージング メカニズムによるIGA対応ボリュームパラメトリックモデルの構築

1. はじめに 
B-rep, CSG などの境界で表現されるパラメトリックモデルに基づくパラメトリック設計は、パラメトリックモデルの可変性・再利用性から、多くの CAD ソフトウェアのコア技術となっている[1-3]。しかし、解析や最適化に適応するためには、パラメトリックモデルをノンパラメトリックメッシュモデルに変換する必要があります。そのため、設計の全工程において、パラメトリックモデルとノンパラメトリックモデルの変換を行ったり来たりする必要があり、多くの時間がかかってしまう。一方、幾何学的パラメータ、材料パラメータ、性能パラメータの間に直接的な解析的関係を確立することは難しく、モデリング、解析、最適化の統合は大きな課題となっています。

モデリング，シミュレーション，最適化間のモデル変換の難しさを克服するために，様々な手法が開発されている．その中で、ボリュームパラメトリックモデルに基づく IGA 手法は、CAD と CAE のシームレスな統合を実現することができる[4]。スプライン基底のテンソル特性により、トポロジーが四辺形または六面体でない領域は、単一のスプライン曲面またはボリュームで表現することができない[5]。したがって、IGAに適したモデルは、2次元では四辺形サーフェスの集合として、3次元では六面体ボリュームとしてボリュームパラメータ化されなければならない。しかし、多くのCADソフトで設計された幾何学モデルは、境界表現に基づいているため、これらのモデルはIGAの要件を満たしていない。

また、IGAに適したモデルを構築するための利用可能なソフトウェアがないことも大きな課題である。既存の文献では、上記の問題を解決するために2つの方法があります。1つ目は、Abaqusのような既存の商用有限要素ソフトウェアとCADを統合する方法[6-8]で、成熟した商用プラットフォームの助けを借りて、設計と解析の間のギャップを埋めようとしています。もう一つは、オープンなソフトウェアパッケージ[9,10]を開発し、与えられた境界によってポリキューブベースのメッシュを生成し、IGAの利用を大幅に促進することである。

本論文では，デザインフィーチャーの Segmentation- Mapping-Merging と呼ばれる機構に基づき，複雑なボリュームパラメトリックモデルを構築する手法を提案する．本手法は、デザインフィーチャーの構築とセグメンテーション、ボリュームパラメトリックマッピング、パラメトリックパッチのマージの3つのステップから構成されている。幾何学的な柔軟性を持たせるために、意味的特徴ネットワークは対話的な入力によって構築することができる。次に、意味的特徴ネットワークは、ボリュームパラメトリックモデリングの制約のもとで、複数の単純なサブネットワークに分割される。次に、ボリュームパラメトリックマッピングにより、各サブネットワークがボリュームパラメトリックパッチとして構築される。最後に、IGAの制約のもと、最適化およびマージ操作により、ボリュームパラメトリックモデルを得る。機械部品や自由形状を含む複雑なモデルを選び、本手法のテストと検証を行った。ここに、その貢献が結ばれる。

・体積パラメトリック設計に基づく統合設計のプラットフォームが提唱されている。現在のCADやCAEソフトで広く使われているパラメトリック設計やフィーチャー設計の考え方や手法も一緒に統合しています。
・ボリュームパラメトリックパッチ（プリミティブ）に対するセグメンテーション・マッピング・マージと呼ばれるモデリング機構・操作を研究している。この機構に基づき、境界面で表現されたモデルから変換することなく、IGAに適したモデルを直接作成することができる。
・提案手法を複雑な3次元機械部品や自由形状モデルに対して実現し、検証した。これにより、複雑な形状に対する体積パラメタリゼーションやIGAへの幅広い応用が期待される。

**********************************************************************************************************

2. 関連作品と概要
CAD と CAE のシームレスな統合は、今日の製品設計における ボトルネックとなる問題であり、多くの研究者の関心を集めてい る。この問題を解決するために、Gujarathi [11]は CAD と CAE をデータから接続するために、モデリングと解析に必要なすべてのパラメータ情報を含む ''Common Data Model'' という概念を提唱している。Wassermann [12]と Schillinger [13]は、適応的なアイソジオメトリック解析と没入境界解析の基礎としてNURBSの階層的な洗練を探求した''DESIGN-THROUGH-ANALYSIS''という方法を提唱した。Cohen [14]は、解析に適したCADモデルを直接構築する解析対応モデリングを提案し、モデルの品質とIGAの結果の精度を向上させた。また，解析指向のモデリング手法を用い て，モデルを自動的に作成または変換する作品もある．Li [15]は，メッシュの複雑さを軽減し，メッシュ品質を向上させるため，一部のフィーチャーを削除してモデルを自動的に簡略化したが，六面体メッシュを自動的に生成することは困難であった．

また、八面体ベースの全六面体メッシュ生成や六面体メッシュ生成のための画像ベース等値化法[20]を動機とした有限セル法（FCM）[16-19]という手法もある。この方法は、B-rep モデル [21]、異種材料からなる複合領域 [22]、微細構造材料 [23] に適しており、さらには体積データ [24] にも利用されています。解析モデルの境界は、クワッドツリー（2D）およびオクトリー（3D）データ構造に配置された適応的なボクセルによって近似されます。

解析に適したモデルを構築する手法の中で，ボリュームパラメトリックモデリング法が注目されている[25]．この手法は，モデルをパラメトリックボリュームに変換する際に，良好な滑らかさを提供し，より少ないストレージスペースで，FEMの離散メッシュに存在する''接着''や''階段''の問題を回避するなどの多くの利点を有している．パラメトリックボリュームに基づき、IGA法がモデルに直接適用されます。他の手法と比較して、IGAは製品設計に適用する際に多くの利点があり、2005年にT. J. R. Hughesによって初めて提案されて以来、多くの研究関心を集めており[26]、NURBSベースのIGAは重要な分岐点となっています[27]。

現在のボリュームパラメトリックモデリングに関する研究は，主にいくつかの重要な側面に焦点を当てている．第一に、Bspline、NURBS（non-uniform rational B-spline）[28]、T-splines[29]、PHT splines [30]などの異なるスプライン基底を用いて、どのようにパラメトリックボリュームを表現するのかということです。2つ目は、点群モデル、ポリゴンメッシュモデル、STEPやIGESなどの標準CADフォーマットによるモデル、FEMメッシュモデルなどの境界表現モデルから、IGAに適したパラメトリックボリュームを構築する方法[31,32]である。第三に、アイソパラメトリック直交最適化[33]、調和関数[34]、ヤコビアン最適化[35]、カーブドリフト[36]など、解析結果に与える影響や効率の異なる最適化手法を使い分け、いかにパラメータ化品質を向上させるかということである。

ボリュームパラメトリックモデルを構築する方法は2つ存在する。一つは、与えられたモデルからモデルを構築するものである。しかし，これらの方法では，複雑なモデルのトポロジカルなセグメンテーションがボトルネックとなる問題である[37-39]．Xiao [40]は，2次元の複雑なパラメトリックモデルを構築する際に，多角形構造を用いている．また，Liu [41]は，モデルのスケルトン曲線を用いて，モデル内部にポリキューブ構造を生成し，ポリキューブとモデル表面とのマッピングにより，ボリュームパラメトリックパッチを生成した．また，Fu [42]は，四面体メッシュモデルのセグメンテーションとマッピングにより，ポリキューブ構造を構築した．Hu [43]は，gCVT を用いた 2 段階の表面セグメンテーション アルゴリズムを提案し，ポリキューブマッピングによって， 六面体と T スプラインのモデルを得た．Chen [44]は，入力された三角メッシュモデル上の法線のl1-ノルムを最小化することによりポリキューブ構造を生成し，内部特異点のない複雑な形状に対するパラメトリックボリュームを得た．しかし，再構築のアプローチにおいて，機械部品などのボリュームパラメトリックモデルを作成することは，まだ困難である[45]．

ボリュームパラメトリックモデルを作成・生成するもう一つの方法は，インタラクティブなパラメトリック構築法を用いる方法である．これに着目した研究として，パラメトリック設計法 [46]，パラメトリックモデルのブーリアン演算法 [47]，モデリングソフトを用いたモデリング法などがある．これらの手法は，インタラクティブな描画やフィーチャモデリング の手法を用いて，新たなボリュームパラメトリックモデルを作成しよ うとするものである．

本論文では，セグメンテーション-マッピング-マージのメカニズムに基づき，特徴量設計とパラメトリック設計を融合したボリュームパラメトリックモデルの構築手法を提案する．本手法は、特徴ネットワークの構築とセグメンテーション、ボリュームパラメトリックマッピング、パッチのマージを含む。モデリングプロセスを図1、図2に示す。

**********************************************************************************************************

3. 意味的特徴ネットワークの基本定義と生成
特徴ネットワークの入力は、モデルのトポロジー構造と形状を記述する様々なサイズパラメータのセットである。これらは対話的な入力から変換されるか、既存のモデルから抽出される。

3.1. 基本的な定義
設計特徴とは、サイズ、形状、トポロジーの側面において、幾何学の大局的および局所的な詳細を記述するための一種の意味的情報である。以下は関連する定義である。

・特徴点 Fp: 特徴曲線や特徴面といった特別な意味を持つ場所を表す点。
・特徴曲線 Fc: 閉じた、または開いた曲線で、特徴面の境界や生成経路を表現する。フィーチャーサーフェスの境界やモデルの生成経路を表現する閉曲線または開曲線 モデルである。
・特徴面Fs：特殊な意味を持つ領域を表現するための閉じたN辺の曲面。
・フィーチャーノードBn：複数のパスの交点。
・パスL：図形の移動方向を記述するためのフィーチャー曲線。それを編集するためのアンカーとして、始点と終点の制御点が定義されている。
・断面S：体積補間法によってパラメトリックボリュームを得ることができる6つの境界面のうちの1つ。
・特徴ネットワーク F : モデルの主要なトポロジー、形状、サイズを記述 するためにあらかじめ定義された特徴によって構成されるネットワー ク。意味的特徴ネットワーク Sem_F、幾何学的特徴ネットワーク Geo_F 、完全特徴ネットワーク Comp_F と呼ばれる3つのグループに分類される。前者は、特徴点、曲線、曲面から構成される。第 2 は、特徴点、パス、断面から構成される。3 番目は、パラメトリックボリュームを補間することができる 6 つの囲まれた断面を示す。

3.2. 意味特徴ネットワークの生成
意味的特徴ネットワーク構築の目的は、特徴をパラメータ化し、モデルの階層的な制御を確立することである。特徴点である曲面、曲線、点には意味情報が多く含まれ、モデル化には適さないため、入力サイズパラメータを用いてこれらの特徴を表現し、修正を容易にするために多層にマッピングしている。

・高レベルのセマンティック層Fhは、長方形の長さと幅、円弧の半径など、ジオメトリの全体的なサイズ、形状、トポロジーを記述するために、できるだけ少ないパラメータを使用する。高レベルのレイヤーは、ユーザーがモデルの全体的なサイズを変更するために公開されている。
・中間レベルの意味層Fmは、始点から曲線の変曲点までの距離など、比較的多くのパラメータを用いて形状を表現する。中間レベル層はカプセル化されている。
・低レベルの意味層Flは、曲面上の角点や曲線上の極値点など、曲面や曲線の基礎となる幾何情報を記述する。パラメータの冗長性を避けるため、曲線や曲面の制御点以外の特徴点を基礎パラメータとする。

上記の定義によれば、意味的特徴ネットワークは次のように書くことができる。
Sem_F = {Fs, Fc, Fp} = {Fh, Fm, Fl}

Fh, Fm, Fl上にそれぞれ{Ph,i, i∈ [1, H]}, {Pm,j, j∈ [1, M]}, {Pl,k, k∈ [1, N]} という三つのパラメータ集合が定義されている。また、これらのパラメータ間で2つの写像演算が定義されている。Φ1＝｛Fhmij｝は、Ph,iからPm,jへの写像である。項目Fhmijは、Ph,iのi番目のパラメータが、Pm,jのj番目のパラメータにどのように寄与するかを提示する。Φ2＝｛Fmljk｝は、PmからPlへの写像である。項目｛Fmljk｝は、Pm,jのj番目のパラメータがPl,kのk番目のパラメータにどのように貢献するかを示すものである。

また、マッピングには、多層に配置されたパラメータ間の制約も反映される。モデリングプロセスでは、マッピング操作を確立することで、高レベルのパラメータから低レベルのパラメータへのマッピングを実現することができる。その結果、ユーザーは少数の高レベルパラメータや設計パラメータで局所的な機能を作成・変更することができ、便利である。

**********************************************************************************************************

4. 幾何学的特徴ネットワークの生成とセグメンテーション
幾何学的特徴ネットワークは、意味的特徴ネットワークから抽出することができる。抽出の際、一部の特徴曲線はパスとして扱われ、パスの交点は特徴ノードとして扱われる。また、閉じていない特徴面は断面として選択される。これらすべてのケースを考慮すると、幾何学的特徴ネットワークは4つのタイプに分類される。

・タイプIは、複数の断面積を持ち、ゼロパスである。
・タイプIIは、1つのセクションの表面と1つのパスを持つ。
・タイプIIIでは、複数のセクション面と単一のパスを持つ。
・タイプIVでは、複数のセクション面を持ち、複数のパスを持つ。

より困難なケースは、後者の 2 つのタイプで発生する。この二つの場合、幾何学的特徴ネットワークは一連の操作によって分割され、最終的にすべての幾何学的特徴ネットワークはタイプ I とタイプ II に分類されることになる。タイプ I の場合、既存の断面から直接いくつかの断面 を追加し、5.2 節で示した方法でパラメトリックボリュームを補 間すれば、完全な特徴ネットワークを容易に生成することができ るだろう。タイプ II の場合、パラメトリックパッチは、5.1 節の直接モデリングによって 得ることになる。

4.1. 交差するパスの切断
最終的に完成するフィーチャーネットワークにはパスは存在しないので、すべてのパスはセクションサーフェスの作成に役立つように処理される必要がある。そこで、タイプ III では、1 つのパスが複数の断面サーフェスに関 連している場合、そのパスを切断する。図 3(a)のように、1つのパスに2つの断面が関係するため、図 3(b)のように上下に2分割されたモデルとなる。指示された点Jnで、図3(c)に示すように、パスが切断される。そして、破断したパスを用いて、押し出し体積を作成する。

4.2. 特徴ノードの分解
タイプIVでは、いくつかのパスが1つの特徴ノードに収束する。このような場合 この場合、パスが分離されるように、特徴ノードで特徴ネットワークを分割し を分割し、各区画面を対応するパスに割り当てる。を対応するパスに割り当てる。このようにすると タイプ IV の特徴ネットワークは、タイプ III に変換される。図4(a)に示すように 図 4(a)に示すように、1 つの特徴ノード Bn のみからなる幾何学的特徴 ネットワーク F Bn は、以下のようになる。は次のように表現される。

Geo_F Bn = {S1, S2, . . . , Sm, L1, L2, . . . , Lm, Bn}

ここで、Si, i ∈ {0,m} は断面、Lj, j ∈ {0,n} はパスであり、m と n はそれぞれ断面、パスの数である。図4（b）に示すように、各部分が最大1つのパスを含むように、交差するパスは特徴ノードBnで分離する必要がある。また、分割された部品を囲むように、いくつかの面Si を追加挿入する必要がある。

交差するパスを分割するために、パスを考慮した六面体ブロック法[48]と呼ばれる手法が拡張される。モデリングの便宜のため、図5に示すように、各表面の交差するパスの方向と数に応じてこのブロックを細分化し、各表面を入射パスの方向に対して可能な限り直交するようにする。直感的に理解できるように、六面体ブロックを通る経路を入射曲線と名付ける。各Bnについて、以下の最適化問題を解く必要がある。

式(2)

ここで、UVWは正規直交基底、djはj番目の入射曲線の方向である。他の線形最適化問題と異なり、式（2）は直交基底UVWの絶対値および2次制約を含む。

式

簡単のために、[49]で紹介されたl1ノルムの滑らかな近似を採用し、この方法で、l1最小化は滑らかな最適化問題に変わる。要素｜x｜は√ x2 + εで置き換えられ、ε > 0 は正則化パラメータで、最小化を通じて徐々に減少させ、滑らかさと正確さのバランスをとる。この方法の具体的な数学的証明は、[50,51]に記載されている。そこで、式（2）を式（3）に置き換えると、式（3）はε＞0と0に近づきながら最小化される。

式(3)

この最小化は、非線形制約問題として考えられている。基底UVWは、方向の集合｛d1, d2, . , dk}のPCAを計算することによって初期化される。問題は経験的な値ε = 0.2で解決され始める。各解は、εの値を半分にすることで次の反復のためのウォームスタートとされる。実験的には、最適化プロセスを終了するには5回の反復が良いだろう。最適化解が得られると、各入射曲線に対応した向きの六面体ボックスの集合が得られる。しかし、1つの面に複数の入射路がある場合は、ボックスを再度分割する必要がある。この面f上のすべての交点とその数nが計算される必要がある。副矩形の方向は，交点をfの辺に平行な2つの基線方向に投影することによって決定される．最後に、fの各面が対応するパスに割り当てられる。その結果をFig.6に示す。

フィーチャーネットワークF Bnは今
Geo_F Bn = {S1, S2, . . . , Sm, L1, L2, . . . , Lk, S1, S2, . . . , Sl}

ここで、kはブロック全体のパスの数であり、m以上である。Siは六面体の箱の境界面である。SiとSiの距離が近いことを考慮すると、両者の間のパスLiは直線とみなすことができる。ここまでは, 交差する経路をBnで切断し, 5.2.3節で六面体ボックスを適用する.

4.3. 断面積の四角形分割
一般的なケースでは、IGAは、ボリュームパラメトリックパッチが六面体であり、全く同じ隣接四角形表面を共有することが必要である。幾何学的特徴ネットワーク Geo_F = {S1, S2, .... Sm, L1, L2, .... Ln}の場合、これらのセクション面はすべて四角形パッチであり、属 性を持たないはずである。そこで、タイプIIIとタイプIVの断面形状を扱うために、四角形パッチを得るための四角形セグメンテーション法を提案し、隣接する断面が1つの一貫した境界曲線を持つことを確認する。

四角形分割の入力は、図 7(a)に示すような、外郭と内郭の両方を持つ断面面の輪郭である。本手法では、いくつかの曲線特徴に基づき、断面面の輪郭をセグメンテーションすることで、断面面を四角形化する。図7（b）に示すように、木のノードとみなされる輪郭間の包含 関係の階層を表現するために、幾何学的な包含木を構築する。ルートノードは最初の外側の輪郭であり、その子 は内側の輪郭である。奇数層と偶数層が外側輪郭と内側輪郭に対応する。各2層の内輪郭と外輪郭によって連結領域が形成される。外側の輪郭だけを持ち、内側の輪郭を持たない連結領域も存在する。

すべての輪郭がセグメンテーションされるため、リーフノードの輪郭から順にレイヤーごとにセグメンテーション操作を行う。多属性の連結領域は、ガイドラインとしていくつかの切断線を追加することで、ゼロ属性の領域に変換する必要がある。セグメンテーションのための前処理として、重み付け法を用いて切断線を選択する。まず、幾何学的な含有木を階層的にトラバースする。次に、異なる幾何学的領域の既存の曲線の端点間に、切断線として直線を追加する。等値性解析における四辺形パッチの品質を考慮し、各実行可能な切断線の重みを計算し、最適な切断線を選択する。

文献[34]から，隣接するエッジ間の角度がパッチの品質に大きく影響することがわかる。そして，凹んだ点が優先的に接続されるので，各切断線の重みは次のようになる。

式たくさん

ここで、iとjは2つの端点のインデックスである。その他のパラメータは図8に示すとおりである。θが大きすぎたり小さすぎたりすると，重みが小さくなり，鋭角にならないようにする。輪郭が曲線の場合は，その接線方向から角度を計算する。重みが大きければ大きいほど，切断線は条件を満たすことになる．最後に、重みに応じて切断線を選択する。切断線が得られたら、四角形分割を行うことができる。δは、輪郭が分割可能かどうかを表すために定義される。δが0であれば，その曲線は細分化できないことを意味する．輪郭を処理する前に，輪郭が内輪郭であればδは0，そうでなければ1である．凸の四辺形の輪郭に対しては，δは0に修正され，集合Qに格納される．

各輪郭が直線で結ばれていると仮定する。すべての輪郭の幾何学的中心点Oi を計算する。を算出し，一番外側の輪郭O と共に，すべての中心点 の値{|O - Oi| ∥ i ∈ [0, n]} で小さいものから大きいものへとソートされる。でソートされ、すべての輪郭が同じ順序でソートされる。の順にソートされる。すべての四辺形パッチは、以下のアルゴリズムに従うことで、1つずつ得ることができる。以下のアルゴリズムに従うことで、全ての四辺形パッチが得られる。

(1)輪郭に含まれる可視点のすべてのペアを検出し、集合Vに格納する。可視点を接続したときに鋭角が生じる場合、そのペアをVから集合Uに移動させる必要がある。

(2)δ=1の1輪郭上の曲線について、その曲線の2つの端点が形成する可視点を求める。この可視点から分割可能な曲線に垂直な点をPvとする。図9(a)のようにPvが分割可能曲線上にあり、かつ端点でない場合、赤い曲線が分割可能曲線、緑の点線が有効接続の縦線となる。Pvが分割可能曲線上にない場合、角度二等分線と分割可能曲線の交点をPbと表記する。図9（b）に示すように、青色の点線は角度二等分線を表している。Pbが存在し、かつ端点でないとき、接続は有効である。Pb が存在しない場合は，図 9（c）のように分割可能な曲線の中点が配線の交点として選択される。52]によれば、接続線の重さを計算することができる。そして、その接続線を集合Lに入れる。

(3)V, Uの接続線の重さも同様に計算する。V, U, Lについて、見える点の組の中に凹んだ点があれば、そのような組を重みの大きいものから小さいものへと並べ替え、その他も同様に並べ替えて集合の一番後ろに配置する。

(4)輪郭の接続線は、V - L - U の順に優先的に選択される。接続線がLに属する場合、交点と両端点の距離の割合に応じて、分割点を元の曲線上にとり、ビューイング可能な点と接続する。

(5)各接続線が作成された後，2つの新しい輪郭が得られる．もしその輪郭が凸の四辺形輪郭であれば，それを集合 Q に入れる．もしその結果が辺の数が 4 より大きい輪郭であれば，その分割優先度は最も高いものに引き上げられる．

(6)V - L - Uと辿っても有効な結果が得られない場合は，全ての輪郭が凸の四辺形輪郭になるまで，優先度の低い接続を選択する必要がある．

(7)すべての凸四辺形輪郭の元の内輪郭および外輪郭に対する包含関係を決定し、各輪郭にパスを関連付けることができるようにした。Coons補間法を用いて、輪郭の4つの境界曲線をNURBS曲面に補間し、曲面と対応するパスにしたがってパラメトリックボリュームを生成する。

臨時頂点の配置は実に大変な作業である。53]では，疎に分布する方向拘束を用いて臨時頂点を自動的に決定している．54]では、パッチ内の全てのメッシュトポロジーを列挙することで臨時頂点を求めているが、これは我々の手法と似ている。現在我々が行っている列挙細分化という手法では、アイソジオメトリック解析における剛性マトリックスのサイズが大きいため、できるだけ少ない四辺形パッチを生成し、四辺形パッチの品質を確保しようとするものである。この細分化機構により、すべての臨時頂点の分布が列挙によって求められる。

52]を拡張し、非日常的な頂点を含む最小限の辺を持つポリゴン領域の集合をリストアップすることが可能である。端点の位置によって、Fig.10(a)(b)に示す準三角形型、Fig.10(c)(d)に示す準矩形型の2種類に分類される。その他の領域は、2つのケースと図10（e）、（f）に示すような四角形のパッチによって組み合わせることができる。したがって、セグメンテーションでは、異常な頂点の数を減らすために、上記のような領域は避ける必要がある。

図11に、いくつかの四角形分割の例を示す。左から順に、分割する断面、切断線を加えた断面、分割結果とそのヤコビアン 値である。

**********************************************************************************************************

5. 完全なフィーチャーネットワークとボリュームパラメトリックマッピング
幾何学的特徴ネットワークのセグメンテーション操作の後、完全な特徴ネットワークを実現することができる。次に、以下の2つの方法で、マッピング操作によりボリュームパラメトリックパッチを作成することができる。

5.1. ダイレクトモデリング
フィーチャーモデリングは、主流のモデリングソフトウェアで一般的に使用されている。押し出し体積、回転体積、掃引体積、ロフト体積などのパラメトリックフィーチャープリミティブを構成するために使用される。

5.1.1. 押出し体積
押し出し体積の場合、経路L (w)は直線である。押し出し体積は、断面S (u, v)をL (w)に沿って平行移動させることで得ることができる。図12(a)は、押し出されたボリュームを示す。

5.1.2. 回転体積
回転したボリュームを図12(b)に示す。押し出しボリュームのモデリングと比較すると、回転ボリュームのパスL（w）は2次円であることがわかる。制御点の重みは常に1ではないため、制御点を計算する際に予め排出する必要がある。制御点の算出は以下のように行う。

Pi,j,k=T · Rx · Ry · Rz · M · (−Ry) · (−Rx) · (−T ) · Pi,j

ここで，T は原点に対する並進行列である．Rx, Ry, Rz は対応する軸の周りの回転行列である. M は重み付けされた事前消去行列であり, 次式で与えられる.

式

5.1.3. 掃引量(スイープ)
掃引体積 V (u, v, w) は、曲線経路 L (w) に沿って断面 S (u, v) を掃引することによって作成することができる。L (w)に沿った数Kの異なる断面が補間され、フィットされる。そして、フィットさせた断面に沿って制御点を算出する。Kの数は決定される必要がある。一般に、Kが大きいほど、得られたモデルの経路L（w）に沿った変動傾向との整合性が高くなる。W方向のノットベクトル数NW¯ knots = K + r + 2とするためには、W方向のノット数を増やすか、セクションの制御点数を増やすのが一般的である。制御点セクションは、Frenetフレームを介したS (u,v) のアフィン変換により、以下のように得ることができる。

式

Frenetフレームは、S (u, v)のアフィン変換の安定性を保証する局所直交座標系を定義している。次に、セクションS (u, v)は位置L (wk) (k = 1, ... , K)に変換される。変換後、wkにおける制御点Pi,jの対応点とは

Qi,j,k = ωk · T2 · T1 · Pi,j

ここで、ωkはL（w）の対応する制御点の重み、T1は射影変換、T2はFrenetフレーム変換である。

すべての制御点区間を求めた後、方程式を解くことで重みP(ω)を持つ制御点を求めることができる。

P(ω) · N = Q

P(ω) i,j,kの重みはωi,j,kであるから、掃引体積の制御点V（u，v，w）はPi,j,k＝P（ω） i,j,k／ωi,j,k となる。K=10の円弧パスに沿って円形断面を掃引して得られる掃引体積を図12(c)に示す。

5.1.4. ロフト付きボリューム
異なる断面形状をロフティングする場合、次数、ノットベクトル、制御点の数など、それらのパラメータを全て統一する必要がある。次数標高を用いることで、同じパラメータ方向にあるすべての断面の次数を、その中で最も高い次数に統一することができる。その後、同じパラメータ方向のノットベクトルを1つの集合にまとめ、各サーフェスの対応するノットベクトルをその集合と同じになるようにリファインする。図12（d）にロフト付きボリュームV（u,v,w)を示す。図中、赤い部分が与えられた断面である。

5.2. 間接モデリング
間接モデリング法では、オフセット、選択、変換の 3 つの操作のいずれかを用いて、完全なフィーチャーネットワークを生成することができる。次に、Coons 補間[33]と呼ばれる方法を用いて、6 つの断面サーフェスからパラメトリック ボリュームを補間することができる。

5.2.1. オフセット操作
特徴ネットワークF={S1, S2, .... Sm, L}の場合、パスに沿って掃引またはロフト化されないような制約がある。例えば、図 13(a)の特徴ネットワークによれば、掃引操作でモデ ル化すると、図 13(b)のような結果になる。図 13(b)のモデルは、特徴ネットワークで下側 断面 S1 が与えられているが、完全な特徴ネットワークの要 件を満たしていないことに注意されたい。図 13(c)のように、パス L は非制約部の角までオフセットされ、非制約部の 境界曲線はパスに沿ってオフセットされる。最後に、Coons 法に従って、図 13(d)のようなボリュームパラ メトリックモデルを構築する。

5.2.2. 選択操作
パスのない特徴ネットワークF={S1, S2, ... . Sm} の場合、特徴ネットワークから対話的に角点を選 択し、線形補間により稜線を生成し、補間によりボリュームパラメトリッ クモデルを生成する。図 14（a）に示すように、赤色の角点 P0, P1 と緑色の角点 P2, P3 を選択し、図 14（b）に示すような稜線を生成する。その結果、図14(c)に示すようなボリュームパラメトリックモデルが得られる。

5.2.3. 変換操作
変換方法は、主に図15に示すような接合部の構造を構築するために使用される。NURBS は四辺形サーフェスしか構築できないが、トーリックサーフェスはポリゴン領域で複雑なサーフェスを補間することができる[55]。

ここでは、トーリックサーフェスをサンプリングし、内部六面体構造にしたがってNURBSサーフェスにフィットさせる。最後に、トーリックサーフェスと内部六面体構造の対応するサーフェスを補間することによって、各パラメトリックボリュームを構築する。

4.2 節で述べたように、交差するパスの分割には六面体ボックス法 が用いられる。幾何学的特徴ネットワークは、特徴ノードを分解した後に得られる。図15（a）に示すように、各表面を対応するパスに沿った掃引体としてモデル化し、SiとLiを用いて内部六面体構造を生成する。そして、サンプリングベクトルとトーリック曲面との交点を求める。六面体構造の角点Pの外部ベクトルには、2つのケースがある。

(1)Pが位置する六面体構造は、モデルの端面φと同じ平面上に1つの端面φを持つ。

    式

    ここで、mはPを端点とする端面φ上の境界曲線の数、⃗viはPから境界曲線の他方の端点までのi番目のエッジの単位ベクトルである。

(2)Pが位置する六面体構造のどの端面も、モデルの端面とは同一平面上にない。

    式

    ここで、nはPを端点とする全ての境界曲線の数、⃗はPから境界曲線の他方の端点までのj番目のエッジの単位ベクトルである。

境界曲線 Ci (u) の両端 (i = 0, 1, 2, 3) は、境界曲線に沿って補間されたサンプリングベクトル⃗vk を持つ二つの外部ベクトル⃗vP , ⃗vQ に対応している。

式たくさん

ここで、Ci(uk)はパラメトリック空間において一様にサンプリングされるが、内六面体構造の境界曲線は直線であるため、サンプリング点は境界曲線上にも一様に分布する。 Rotate(⃗vP, ȇα) はvrを回転軸として⃗vPを反時計回りに角度αだけ回すこと、θは⃗vP と⃗vQ が成す角度、を表す。

この方法によって、境界曲線上に分布するK個のサンプリングベクトルが得られる。次に、ニュートン反復法[56]を用いて、サンプリングベクトルとトーリック曲面との交点を解く。図 15 に特徴点ネットワークから容易に得られる接合モデルを示す。

**********************************************************************************************************

6. パラメトリックパッチのマージ
すべてのパラメトリックパッチが生成された後、それらをマージしてモデル全体を形成する必要があります。我々のモデリングプロセスでは、隣接する2つのボリュームパラメトリックパッチが1つの完全なサーフェスを共有することが要求されます。そのため、パッチ間の連続性を高めることは非常に重要なことであり、ここで議論する必要があります。また、作成したモデルにフィーチャーを追加したり、フィーチャーを削除したりする場合、新たに生成したフィーチャーと作成したモデルをどのように結合するかも問題となる。従来のモデリング手法では、この操作はブーリアン演算で済ませることができる。新しい特徴を含む特徴ネットワークを再定義し、モデル全体を作り直すこともできるが、やはり未修正の部分はそのままにして作業負荷を最小化するのが良い。そのため、ブーリアン演算をどのようにモデリング手法に実装するかは、今後の課題である。

6.1. マージ時の連続性の強化
2つのパッチ間の共有面はセグメンテーションによって抽出されているため，補間時にこれらの面を変更しないことは良いアイデアである．接触面の連続性を向上させるために、Continuity法[57]を用いることができる。図17に示すように、同じ物理空間Ω=Ω(1)∪Ω(2)に幾何学的に対応する2つのパラメータ空間 ˆΩ(1), ˆΩ(2) が存在する。物理空間では、2つのパッチ τ=G(1) (1, η, ς) = G(2) (0, η, ς) を結ぶ共通の曲面が存在します。本研究ではC1連続性が要求されるので、τにおいてC0連続性を持つ基底関数Ni(ξ , η, ς)を全て削除し、C1連続性関数に置き換える必要がある。削除された関数をRi(ξ , η, ς)と呼ぶ。除去された関数の物理的領域における対応する関数をℜi(x, y, z)とする。新しい関数 ψ(x, y, z) は ȑi(x, y, z) の線形結合を与えるように構成される。

式

ここで、ci は ȑi (x, y, z) のスカラー係数、nȑ は除去された関数の数を表す。ψi(x, y, z) = ψ (1) i (x, y, z)+ψ (2) i (x, y, z) であり、ψk i (x, y, z) はパッチk上にサポートを持つとすると、C1連続性条件の要件は。

式

ψ(k)(x, y, z)の関連関数として物理領域のφ(k)(x, y, z)を設定すると、ψk i (x, y, z)の表面を通じて連続条件を課すことができる。

式

連続性制約は次の通りである。

式

6.2. ブール演算に基づくマージ方法
従来のブール演算と同様に、追加された特徴を実特徴、切断された特徴を仮想特徴として定義する。そのため、実-実合併と実-仮想合併の2つのケースが発生する。文献[58]、[59]では、B-repブーリアン演算のアルゴリズムを用いて、体積ブーリアン演算を実証している。また、T-splineも高品質なボリューメトリックブーリアン演算のために考慮されている[47]。また、異種材料を持つ2つのソリッドに対するブーリアン演算の実行も非常に興味深いものです[60]。単純な体積パラメトリック固体上で実仮想ブール演算を実行することは、簡単なことではありません[61]。

ここでは、将来的によく研究されるであろう我々のアイデアを示すために、簡単な例を挙げる。生成されたパラメトリックボリュームに対してブーリアン演算を適用することは、ボリュームの境界を探索するための退屈で難しい作業につながるが、その代わりに、特徴ネットワークに対してブーリアン演算を実行する。本手法では、体積のブール演算は表面のブール演算に還元される。将来的には、より複雑なモデルに対してこの合成方法を拡張する予定である。図 16(a)に示すように、円柱と六面体をマージする必要があるが、マ ージングの手順は以下の通りである。

(1)ボリューム・パラメトリック・パッチの6つの面を抽出し、どの面が交差しているかを判断する。そして、図16（b）のように、交差する面をS1、S′1とする。

(2)S1とS′1の交線の集合τを計算し、図16（c）のように、τを初期輪郭の集合Ωに入れる。

(3)Ωの四角形分割を行い、四角形パッチを特徴ネットワークの断面面として得る。

(4)図16（d）に示す断面曲面の対応するパスL1、L′1を求める。実数結合の場合は、図16（e）に示す断面面とパスにより円柱と六面体を構成し、それ以外の場合は、交線τの集合を四角形分割の属とみなして、パスL1により図16（f）に示す六面体を構成する。

**********************************************************************************************************

7. 例

本手法の有効性を示すために、いくつかの典型的な機械部品と自由形状モデルを構築し、そのヤコビアン値で評価する。さらに、IGAを適用して、生成されたモデルの利用率を検証する。紙面の都合上、一部のパラメータについてのみ数式を示す。モデリングにはC++を、レンダリングにはVS2017のOpenGLを使用しています。

7.1. 機構部品のモデリングと自由形状モデル
7.1.1. 標準的な機械部品
円筒平歯車は，主に法線モジュール m，歯数 z，法線圧力角 α，付加係数 hax，底面すきま係数 cx，修正係数 x，歯車軸方向幅 B，歯車内径 Dx の 8 つのパラメータで形状が決まる標準的な機械部品である．このうち，最後の2つのパラメータは一般に固定され，xは0に等しい．最初の5つのパラメータは，高レイヤーパラメータとして選択される．平歯車の全体形状は，図18(a)の例のように信号歯車特徴面を持つ形状が得られる．

基準直径D = mz，加算円直径ha = (hax + x)m， 減算円直径hf = (hax + cx - x)m， 加算円直径Da = D + 2ha， ベース円直径Db = D cosα，減算円直径Df = D - 2hf， フィレット半径r = 0.38m， 歯厚S = mπ/2 は局所表面および線構造を表す中層パラメータとして選択した．

境界上の制御点は，低レベルのパラメータとして扱われる．その中でも，図18(b)に示すように，歯車歯形上の制御点が最も複雑である．歯車歯形は円弧で近似され，NURBS[62]で表現される．P1，P2，P3はそれぞれ歯形と歯先円，基準円，歯元円との交点である．また，Da，D，Dbは，それぞれインボリュート方程式に代入して求めることができる．そして、この3点を用いて近似円を求める。点ptは点p1と点p2における接線の交点である。寸法パラメータは、歯形の制御点に対応させる。

歯車の外形が得られたら，歯車ユニットを四角形に分割することができ る．最後に，歯数に応じて配列し，掃引体積にマッピン グして，図18に示す平歯車全体として結合する．

7.1.2. 非標準の機械部品
非標準の機械部品は、通常、図 19 に示すような不規則な形状をしてい る。最初のコラムでは、主要な特徴面の一例として、入力のサイズパラメータを示す。2 列目には、幾何学的特徴ネットワークの主要部分の模式図を示す。

最後の行のインペラモデルは、一般的なモデリングプロセスを示すための例として取り上げられたものである。最初の図では、意味的特徴ネットワークにおけるすべてのパラメータが示されている。

ファンブレードとハブの接触特徴面は正円形であるため，平面上に容易に投影することができる。ハブとファンブレードの投影はともに長方形である。最初の図では、Fh = {l1, l2, l3, α, Pt }で、l1 と l2 がハブの形状、l3 とαがファンブレードの形状、 Pt がファンブレードの中心点を定義している。Fhによれば、Fm = {l4, l5, l6, Pc }が得られ、l5 = 2Pt .y/ sin α、l6 = l1 - Pt .x - l3/2 - Pt .y/ tan αである。そして、表面上の制御点を低レベルパラメータ Fl = {P0, P1, P2, P3, P4, P5, P6, P7, P8, P9}, P7 = (l1 - l6 - l3 - l5cosα, l5sinα) として、意味特徴ネットワークを求め、 入力パラメータから制御点へのマッピングを作成する。2 列目では、幾何学的特徴ネットワーク Geo_F = {S1, S2, S3, S4, S5, L1, L2} が得られる。S5とS4はS3のアフィン変換で得られ、S1はS2のアフィン変換で得ることができる。接触断面の投影面をセグメンテーションし、セグメンテーション結果をサーフェスに写像する必要がある。次に、スイープとレボリューションにより、パラメトリックボリュームを得る。最後に、すべての部品を統合し、3枚目の写真のようなインペラ全体が得られる。

7.1.3. 自由形式モデル
自由形状モデルは、常にねじれた形状や不規則な構造を持っている。このようなモデルでは、対話的な操作によるパスの入力や、既存のモデルからの自動抽出が可能である。これらのモデルのパスは非常に複雑であるため、特徴ノードのセグメンテーションは容易でない。そこで、セグメンテーションと変換によるマッピングを行い、さらにマージ操作を行うことで、モデル全体が出来上がる。図 20 に示すように、それぞれ 8 モデル、犬、格子の構造である。

7.2. 複雑なボリュームパラメトリックモデルのためのIGA
我々のモデリング手法を用いることで、複雑な三次元形状に直接IGAを適用することができ、本手法を多くの分野に拡張する機会を提供することができる。本手法は、Hughes [38] が発表した手法を改良し、アルゴリズムの詳細を省き、適用範囲の広い手法として実現したものである。解析対象は軸受ブロックと減速機とし、その解析結果を図21に示す。

図では、ベアリングブロックが(a)に記載されており、底面上部の穴の半分にかかる荷重と、底面の2つの穴にかかる制約がモデルに適用されている。減速機は(c)に記載されており、2辺の6つの穴に対する荷重と、底面の4つの穴に対する拘束が適用されています。カラフルな形状で表示された解析結果を(b)と(d)に示す。他の市販 CAE ソフトの解析結果と比較することで，解析 結果の偏差を確認することができる。

**********************************************************************************************************

8. 結論
本論文では、機械部品と自由形状モデルのための体積パラメタリゼーション手法を紹介する。本手法は、B-repモデルから変換するのではなく、モデルを作成するものであり、従来の多くの手法とは異なる。また，本手法では，パラメトリック設計とフィーチャー設計のエッセンスを取り入れている．また、提案するセグメンテーション-マッピング-マージ機構は、ボリュームパラメータ化およびIGAの研究においてボトルネックとなっている幾何学および物理学の複雑な3次元モデルの生成およびシミュレーションを支援するものである。以上のことから、体積パラメタリゼーションとIGAは、現在主流の商用設計ソフトウェアに受け入れられ、統合されることになる。さらに、本手法により、複雑なモデルのリアルタイムパラメトリックシミュレーションを実現することができ、これは我々の特徴的な仕事となるであろう。

しかし、体積パラメトリックモデルのモデリングプロセスにおいて、特異点の分布や操作の品質管理など、より多くの制約を課すことは現在研究中である。また、複雑な体積パラメトリック立体への異種材料の付加も今後の研究課題である。


**********************************************************************************************************

memo

デザインフィーチャー
設計特徴とは、サイズ、形状、トポロジーの側面において、幾何学の大局的および局所的な詳細を記述するための一種の意味的情報である。

BRepモデリング, ←ソリッドモデル, CSG
BRepモデリング（Boundary Representation modeling）は、CADアプリケーションにおいて最も一般的なモデリングの種類です。BRepは、3Dオブジェクトの数学的に正確な表現です。この表現は、ソリッドと非ソリッドの幾何学的な境界を定義します。

解析モデルの作成方法
対話的な入力でパスを作成    or  既存のモデルから自動的に抽出

自動生成というよりは支援ツールという立ち位置

ボリュームパラメトリックモデル
IGA解析モデルのこと

階層化する理由
ユーザーは少数の高レベルパラメータや設計パラメータで局所的な機能を作成・変更することができ、便利である。

FEMの4面体要素とかだと，できる

パス:   一部の特徴曲線

マージ，セグメント境界の点が一致していないのでマージを行う